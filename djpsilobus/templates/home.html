{% extends "base.html" %}
{% block extra_javascript %}
<script src="//www.carthage.edu/static/vendor/dashboard/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="//www.carthage.edu/static/vendor/dashboard/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script type="text/javascript">
$(function(){
  var table = $('.courses-data').dataTable({
    "bPaginate": false
  });
  $(".required > input").addClass("required");
  $(".required > select").addClass("required");
  $(".required > textarea").addClass("required");
  $(".warning > input").addClass("error");
  $(".warning > select").addClass("error");
  $(".warning > textarea").addClass("error");
  $(".required > ul").parent().parent().find('h3').addClass("required");
  $('#olvidado').click(function(e) {
    e.preventDefault();
    $('div#form-olvidado').toggle('500');
  });
  $('#acceso').click(function(e) {
    e.preventDefault();
    $('div#form-olvidado').toggle('500');
  });
  $('select[name^="dept_faculty_"]').change(function(){
    $('#faculty-courses').submit();
  });
  $('#toggle-departments').click(function(){
    $(this).text(function(i,old){
      return old=='Show Departments' ? 'Hide Departments' : 'Show Departments';
    });
  });
  // flag syllabi for upload.
  // cgi on the backend does not include empty file fields in []
  $("#courses").on('change', ".syllabi", function() {
    $(this).next(':hidden').val("True");
  });
  $('.section').each(function(){
    var $dis = $(this);
    var $html = $dis.html();
    var $name = $dis.attr("data-fullname").substring(1);
    var $phile = $dis.attr("data-phile") + ".pdf";
    $dis.html('<i class="fa fa-cog fa-spin fa-2x fa-fw"></i>');
    $.ajax({
      type: "POST",
      url: "{% url 'dspace_file_search' %}",
      data: {"phile":$phile,"name":$name},
      cache: false,
      success: function(data) {
        if (data) {
          $dis.html(data);
        } else {
          $dis.html($html);
        }
      },
      error: function(data) {
        $dis.html(
          '<i class="fa fa-times red" aria-hidden="true" title="API error"></i>'
        );
      }
    });
  });
});
</script>
{% endblock extra_javascript %}
{% block extra_style %}
    <style type="text/css">
        td, select, input, p {font-size:.9em;}
        select, input {margin-bottom:5px;}
        fieldset {
            border: 1px solid silver;
            margin: 5px 2px;
            padding: .35em .625em .75em;
        }
        legend {
            display: block;
            padding: 2px 10px !important;
            border: 1px solid #dcdcdc;
            border-radius: 10px;
            background-color: #003c4b;
            padding: 0;
            margin-bottom: 0;
            width:initial;
            color: #fff;
            font-size:.9em;
        }
        #toggle-departments {width:150px;}
        #notice {
            position:absolute; top:175px; left:300px; background-color:#880000;
            border:3px solid white; opacity: .80; filter:Alpha(Opacity=80);
            display:none; color:white; padding:20px; width:300px; z-index:1000;
        }
        .deptHead {width:420px;float:left;margin-right:20px;}
        .section {text-align:center;}
    </style>
{% endblock extra_style %}
{% block content %}
<div class="row">
    <div class="col-lg-12">
      <h2>
        {% if depts %}
          You may view the following departments
          <button id="toggle-departments" aria-expanded="true" type="button"
            data-toggle="collapse" data-target="#departments"
            class="btn btn-success collapsed">
            Hide Departments
          </button>
        {% else %}
          Greetings, {{user.first_name}} {{user.last_name}}
        {% endif %}
      </h2>
        {% if phile %}<p>{{phile}}</p>{% endif %}
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{% if depts %}
<div class="row collapse in" id="departments">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-body">
          <form action="{% url 'home' %}" method="post"
            name="faculty-courses"
            id="faculty-courses">
            {% csrf_token %}
            {% for d in depts %}
              <fieldset class="deptHead">
                <legend>{{d.dept.txt}}</legend>
                <div class="form-row">
                  <label for="dept_faculty_{{d.dept.dept}}">
                    View all courses for:
                  </label>
                  <select name="dept_faculty_{{d.dept.dept}}">
                    <option value="">(Select One)</option>
                    {% for f in d.faculty %}
                      <option value="{{f.id}}">
                        {{f.lastname}}, {{f.firstname}}
                      </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="form-row">
                  <a href="{% url 'home_dept' d.dept.dept %}">
                    View all courses for {{d.txt}}
                  </a>
                </div>
              </fieldset>
            {% endfor %}
          </form>
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{% endif %}
{% if courses %}
<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <h2>
          {% if department %}
            {{department}} Syllabi:
          {% else %}
            {% if not department and fid == user.id %}
              My Syllabi:
            {% else %}
              {{faculty_name}}'s Syllabi:
            {% endif %}
          {% endif %}
          {{sess}} {{year}}
        </h2>
        <div class="table-responsive">
          <form action="{% url 'home' %}" method="post"
            enctype="multipart/form-data">
            {% csrf_token %}
            <table class="table table-striped table-bordered table-hover
              dataTable display courses-data" id="courses">
              <thead>
                <tr>
                  <th style="text-align:center;">Course #</th>
                  <th style="text-align:center;">Course Title</th>
                  <th style="text-align:center;">Secion Number</th>
                  <th style="text-align:center;">Instructor</th>
                  <th style="text-align:center;">Syllabus</th>
                </tr>
              </thead>
              <tbody>
                {% include "syllabi_table.inc.html" %}
              </tbody>
              <tfoot>
                <tr>
                  <th style="text-align:center;">Course #</th>
                  <th style="text-align:center;">Course Title</th>
                  <th style="text-align:center;">Secion Number</th>
                  <th style="text-align:center;">Instructor</th>
                  <th style="text-align:center;">Syllabus</th>
                </tr>
              </tfoot>
            </table>
          </form>
        </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
{% else %}
    <p class="clear">There are no course records.</p>
{% endif %}
{% endblock content %}
